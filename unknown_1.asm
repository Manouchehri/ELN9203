__config 0x3F72

;Settings

INCLUDE P16F877A_1.INC

PORTB EQU 06
PORTA EQU 05
INTCON EQU 0B
BCD EQU 23
parta EQU 24
partb EQU 25
partc EQU 26
store EQU 22

INT_LED2    EQU 1
INT_LED     EQU 5
intin       EQU 0
intrel      EQU 4
INTF        EQU 1

 Org 00
GOTO Initialize

org 008

MOVF PORTB,W
MOVWF store
;CLRF PORTB

INTERRUPT BSF PORTA, INT_LED
CALL CLOCK
BCF PORTA,INT_LED
CALL CLOCK
BSF PORTA, INT_LED2
CALL CLOCK
BCF PORTA,INT_LED2
BTFSC PORTA,intrel
GOTO INTERRUPT
;CLRF PORTB
MOVWF PORTB
BCF INTCON,INTF
RETFIE


Initialize MOVLW b'00000000'
TRIS PORTB
;CLRF PORTB
 MOVLW b'00010000'
           TRIS PORTA
           CLRF PORTA
           MOVLW b'11010000'
           MOVWF INTCON


MOVLW 21
MOVWF BCD
GOTO MAIN


SvenSeg MOVF BCD,W
ADDWF PCL
NOP
NOP
RETLW 0DE
CALL CLOCK
NOP
RETLW 0DE
CALL CLOCK
NOP
RETLW 0FE
CALL CLOCK
NOP
RETLW 00E
CALL CLOCK
NOP
RETLW 0F8
CALL CLOCK
NOP
RETLW 0DA
CALL CLOCK
NOP
RETLW 0CC
CALL CLOCK
NOP
RETLW 09E
CALL CLOCK
NOP

RETLW 0B6
CALL CLOCK
NOP
RETLW 00C
CALL CLOCK
NOP
RETLW 07E
CALL CLOCK
NOP




CLOCK   MOVLW 06D
        MOVWF parta
        MOVLW 05E
        MOVWF partb
        MOVLW 01A
        MOVWF partc
DELAY     DECFSZ parta,1
        GOTO DELAY
        DECFSZ partb,1
        GOTO DELAY
        DECFSZ partc,1
        GOTO DELAY
        RETURN




MAIN CALL SvenSeg
MOVWF PORTB
DECFSZ BCD
GOTO MAIN


END